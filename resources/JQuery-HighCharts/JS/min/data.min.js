(function(b){var a=b.each,c=function(e,d){this.init(e,d)};b.extend(c.prototype,{init:function(e,d){this.options=e;this.chartOptions=d;this.columns=e.columns||this.rowsToColumns(e.rows)||[];this.columns.length?this.dataFound():(this.parseCSV(),this.parseTable(),this.parseGoogleSpreadsheet())},getColumnDistribution:function(){var e=this.chartOptions,d=e&&e.chart&&e.chart.type,f=[];a(e&&e.series||[],function(g){f.push((b.seriesTypes[g.type||d||"line"].prototype.pointArrayMap||[0]).length)});this.valueCount={global:(b.seriesTypes[d||"line"].prototype.pointArrayMap||[0]).length,individual:f}},dataFound:function(){if(this.options.switchRowsAndColumns){this.columns=this.rowsToColumns(this.columns)}this.parseTypes();this.findHeaderRow();this.parsed();this.complete()},parseCSV:function(){var v=this,u=this.options,t=u.csv,s=this.columns,r=u.startRow||0,n=u.endRow||Number.MAX_VALUE,m=u.startColumn||0,p=u.endColumn||Number.MAX_VALUE,q,l,j=0;t&&(l=t.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split(u.lineDelimiter||"\n"),q=u.itemDelimiter||(t.indexOf("\t")!==-1?"\t":","),a(l,function(d,g){var e=v.trim(d),f=e.indexOf("#")===0;g>=r&&g<=n&&!f&&e!==""&&(e=d.split(q),a(e,function(h,i){i>=m&&i<=p&&(s[i-m]||(s[i-m]=[]),s[i-m][j]=h)}),j+=1)}),this.dataFound())},parseTable:function(){var g=this.options,f=g.table,n=this.columns,m=g.startRow||0,l=g.endRow||Number.MAX_VALUE,k=g.startColumn||0,j=g.endColumn||Number.MAX_VALUE;f&&(typeof f==="string"&&(f=document.getElementById(f)),a(f.getElementsByTagName("tr"),function(e,d){d>=m&&d<=l&&a(e.children,function(h,i){if((h.tagName==="TD"||h.tagName==="TH")&&i>=k&&i<=j){n[i-k]||(n[i-k]=[]),n[i-k][d-m]=h.innerHTML}})}),this.dataFound())},parseGoogleSpreadsheet:function(){var t=this,s=this.options,r=s.googleSpreadsheetKey,q=this.columns,p=s.startRow||0,m=s.endRow||Number.MAX_VALUE,l=s.startColumn||0,n=s.endColumn||Number.MAX_VALUE,o,j;r&&jQuery.ajax({dataType:"json",url:"https://spreadsheets.google.com/feeds/cells/"+r+"/"+(s.googleSpreadsheetWorksheet||"od6")+"/public/values?alt=json-in-script&callback=?",error:s.error,success:function(e){var e=e.feed.entry,i,g=e.length,d=0,h=0,f;for(f=0;f<g;f++){i=e[f],d=Math.max(d,i.gs$cell.col),h=Math.max(h,i.gs$cell.row)}for(f=0;f<d;f++){if(f>=l&&f<=n){q[f-l]=[],q[f-l].length=Math.min(h,m-p)}}for(f=0;f<g;f++){if(i=e[f],o=i.gs$cell.row-1,j=i.gs$cell.col-1,j>=l&&j<=n&&o>=p&&o<=m){q[j-l][o-p]=i.content.$t}}t.dataFound()}})},findHeaderRow:function(){a(this.columns,function(){});this.headerRow=0},trim:function(d){return typeof d==="string"?d.replace(/^\s+|\s+$/g,""):d},parseTypes:function(){for(var g=this.columns,f=g.length,l,k,j,i;f--;){for(l=g[f].length;l--;){k=g[f][l],j=parseFloat(k),i=this.trim(k),i==j?(g[f][l]=j,j>31536000000?g[f].isDatetime=!0:g[f].isNumeric=!0):(k=this.parseDate(k),f===0&&typeof k==="number"&&!isNaN(k)?(g[f][l]=k,g[f].isDatetime=!0):g[f][l]=i===""?null:i)}}},dateFormats:{"YYYY-mm-dd":{regex:"^([0-9]{4})-([0-9]{2})-([0-9]{2})$",parser:function(d){return Date.UTC(+d[1],d[2]-1,+d[3])}}},parseDate:function(g){var f=this.options.parseDate,j,i,h;f&&(j=f(g));if(typeof g==="string"){for(i in this.dateFormats){f=this.dateFormats[i],(h=g.match(f.regex))&&(j=f.parser(h))}}return j},rowsToColumns:function(g){var f,l,k,j,i;if(g){i=[];l=g.length;for(f=0;f<l;f++){j=g[f].length;for(k=0;k<j;k++){i[k]||(i[k]=[]),i[k][f]=g[f][k]}}}return i},parsed:function(){this.options.parsed&&this.options.parsed.call(this,this.columns)},complete:function(){var t=this.columns,s,r,q=this.options,p,m,l,n,o,j;if(q.complete){this.getColumnDistribution();t.length>1&&(s=t.shift(),this.headerRow===0&&s.shift(),s.isDatetime?r="datetime":s.isNumeric||(r="category"));for(n=0;n<t.length;n++){if(this.headerRow===0){t[n].name=t[n].shift()}}m=[];for(n=0,j=0;n<t.length;j++){p=b.pick(this.valueCount.individual[j],this.valueCount.global);l=[];if(n+p<=t.length){for(o=0;o<t[n].length;o++){l[o]=[s[o],t[n][o]!==void 0?t[n][o]:null],p>1&&l[o].push(t[n+1][o]!==void 0?t[n+1][o]:null),p>2&&l[o].push(t[n+2][o]!==void 0?t[n+2][o]:null),p>3&&l[o].push(t[n+3][o]!==void 0?t[n+3][o]:null),p>4&&l[o].push(t[n+4][o]!==void 0?t[n+4][o]:null)}}m[j]={name:t[n].name,data:l};n+=p}q.complete({xAxis:{type:r},series:m})}}});b.Data=c;b.data=function(e,d){return new c(e,d)};b.wrap(b.Chart.prototype,"init",function(f,e,h){var g=this;e&&e.data?b.data(b.extend(e.data,{complete:function(d){e.hasOwnProperty("series")&&(typeof e.series==="object"?a(e.series,function(i,j){e.series[j]=b.merge(i,d.series[j])}):delete e.series);e=b.merge(d,e);f.call(g,e,h)}}),e):f.call(g,e,h)})})(Highcharts);