<!DOCTYPE html>

<html>
<head>
  <title>defa.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="a_dosis.html">
                  a_dosis.js
                </a>
              
                
                <a class="source" href="a_esp.html">
                  a_esp.js
                </a>
              
                
                <a class="source" href="a_unidad.html">
                  a_unidad.js
                </a>
              
                
                <a class="source" href="adm_reasignar.html">
                  adm_reasignar.js
                </a>
              
                
                <a class="source" href="adm_regs.html">
                  adm_regs.js
                </a>
              
                
                <a class="source" href="adm_regs_docsedit.html">
                  adm_regs_docsedit.js
                </a>
              
                
                <a class="source" href="adm_regs_edit.html">
                  adm_regs_edit.js
                </a>
              
                
                <a class="source" href="apm.html">
                  apm.js
                </a>
              
                
                <a class="source" href="apms.html">
                  apms.js
                </a>
              
                
                <a class="source" href="canal.html">
                  canal.js
                </a>
              
                
                <a class="source" href="canales.html">
                  canales.js
                </a>
              
                
                <a class="source" href="clientes.html">
                  clientes.js
                </a>
              
                
                <a class="source" href="control_venta.html">
                  control_venta.js
                </a>
              
                
                <a class="source" href="datos_pac.html">
                  datos_pac.js
                </a>
              
                
                <a class="source" href="defa.html">
                  defa.js
                </a>
              
                
                <a class="source" href="diff_med.html">
                  diff_med.js
                </a>
              
                
                <a class="source" href="docs_canales.html">
                  docs_canales.js
                </a>
              
                
                <a class="source" href="docs_hist_medico.html">
                  docs_hist_medico.js
                </a>
              
                
                <a class="source" href="docs_hist_paciente.html">
                  docs_hist_paciente.js
                </a>
              
                
                <a class="source" href="docs_medico.html">
                  docs_medico.js
                </a>
              
                
                <a class="source" href="docs_paciente.html">
                  docs_paciente.js
                </a>
              
                
                <a class="source" href="dosis.html">
                  dosis.js
                </a>
              
                
                <a class="source" href="especialidades.html">
                  especialidades.js
                </a>
              
                
                <a class="source" href="funciones.html">
                  funciones.js
                </a>
              
                
                <a class="source" href="generar_venta.html">
                  generar_venta.js
                </a>
              
                
                <a class="source" href="get_apm_info.html">
                  get_apm_info.js
                </a>
              
                
                <a class="source" href="informes.html">
                  informes.js
                </a>
              
                
                <a class="source" href="informes_docs_nue_pres.html">
                  informes_docs_nue_pres.js
                </a>
              
                
                <a class="source" href="informes_nue_pres.html">
                  informes_nue_pres.js
                </a>
              
                
                <a class="source" href="institucion.html">
                  institucion.js
                </a>
              
                
                <a class="source" href="instituciones.html">
                  instituciones.js
                </a>
              
                
                <a class="source" href="listado.html">
                  listado.js
                </a>
              
                
                <a class="source" href="listado_details.html">
                  listado_details.js
                </a>
              
                
                <a class="source" href="log.html">
                  log.js
                </a>
              
                
                <a class="source" href="log_accesos.html">
                  log_accesos.js
                </a>
              
                
                <a class="source" href="login.html">
                  login.js
                </a>
              
                
                <a class="source" href="medico.html">
                  medico.js
                </a>
              
                
                <a class="source" href="medicos.html">
                  medicos.js
                </a>
              
                
                <a class="source" href="modificar_venta.html">
                  modificar_venta.js
                </a>
              
                
                <a class="source" href="nueva_venta.html">
                  nueva_venta.js
                </a>
              
                
                <a class="source" href="paciente.html">
                  paciente.js
                </a>
              
                
                <a class="source" href="pacientes.html">
                  pacientes.js
                </a>
              
                
                <a class="source" href="panel.html">
                  panel.js
                </a>
              
                
                <a class="source" href="panel_mod.html">
                  panel_mod.js
                </a>
              
                
                <a class="source" href="patologia.html">
                  patologia.js
                </a>
              
                
                <a class="source" href="patologias.html">
                  patologias.js
                </a>
              
                
                <a class="source" href="reasignados.html">
                  reasignados.js
                </a>
              
                
                <a class="source" href="reasignar.html">
                  reasignar.js
                </a>
              
                
                <a class="source" href="reporte_360.html">
                  reporte_360.js
                </a>
              
                
                <a class="source" href="reporte_ANMAT.html">
                  reporte_ANMAT.js
                </a>
              
                
                <a class="source" href="reporte_docs_paciente.html">
                  reporte_docs_paciente.js
                </a>
              
                
                <a class="source" href="reporte_filtros.html">
                  reporte_filtros.js
                </a>
              
                
                <a class="source" href="reporte_grilla.html">
                  reporte_grilla.js
                </a>
              
                
                <a class="source" href="reporte_productos.html">
                  reporte_productos.js
                </a>
              
                
                <a class="source" href="reporte_reasignaciones.html">
                  reporte_reasignaciones.js
                </a>
              
                
                <a class="source" href="reporte_ventas.html">
                  reporte_ventas.js
                </a>
              
                
                <a class="source" href="reporte_ventas_apm.html">
                  reporte_ventas_apm.js
                </a>
              
                
                <a class="source" href="reporte_ventas_paciente.html">
                  reporte_ventas_paciente.js
                </a>
              
                
                <a class="source" href="reportes_panel.html">
                  reportes_panel.js
                </a>
              
                
                <a class="source" href="seguridad.html">
                  seguridad.js
                </a>
              
                
                <a class="source" href="unidades.html">
                  unidades.js
                </a>
              
                
                <a class="source" href="usuario.html">
                  usuario.js
                </a>
              
                
                <a class="source" href="usuarios.html">
                  usuarios.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>defa.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/* version 1.0 */</span>

<span class="hljs-keyword">var</span> timer;
<span class="hljs-keyword">var</span> counter = <span class="hljs-number">0</span>;
<span class="hljs-keyword">var</span> aplicacion = getCurrentHostname() + <span class="hljs-string">"/"</span> + getUrlHTTP();

$(<span class="hljs-built_in">document</span>).ready(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">window</span>.onload = timerReset;
  <span class="hljs-built_in">document</span>.onkeypress = timerReset;
  <span class="hljs-built_in">document</span>.onmousemove = timerReset;
  <span class="hljs-built_in">document</span>.onmousedown = timerReset;
  <span class="hljs-built_in">document</span>.ontouchstart = timerReset;
  <span class="hljs-built_in">document</span>.onclick = timerReset;
  <span class="hljs-built_in">document</span>.onscroll = timerReset;
  <span class="hljs-built_in">document</span>.onkeypress = timerReset;

  $(<span class="hljs-string">".popUP"</span>).hide();
  
  <span class="hljs-comment">/**
   * Se actualiza esta funcion con la idea de que 
   * pueda ser redirigida a la url provista por un mail
   * o link y cargar directamente en el iframe 
   * la url de la pagina
   * Ejemplo de pagina con argumentos(queryString)
   * 'http://localhost/soliris/defa.php?url=/main/modificar_venta.php&amp;args=?idVenta=67'
   * url= /main/modificar_venta.php
   * args=?idVenta=67
   * FIXME considerar en una nueva implementacion agregar un parametro mas de opcion
   * como por ejemplo poder manejar la url: 
   * http://localhost/soliris/main/modificar_venta.php/?idVenta=67&amp;read=true
   */</span>
  <span class="hljs-keyword">if</span> (getQuerystring(<span class="hljs-string">"url"</span>)) {
    <span class="hljs-keyword">var</span> urlParams = <span class="hljs-keyword">new</span> URLSearchParams(location.search);
    
    <span class="hljs-keyword">let</span> page = urlParams.get(<span class="hljs-string">'url'</span>);
    <span class="hljs-keyword">let</span> args = urlParams.get(<span class="hljs-string">'args'</span>);
    
    <span class="hljs-comment">/**
     * Verifico que la pagina no tenga un querystring
     */</span>
    <span class="hljs-keyword">if</span>(args == <span class="hljs-literal">null</span>){
        pop(aplicacion + page);
    } <span class="hljs-keyword">else</span> {
        pop(aplicacion + page + args);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Limpio la url para que visualmente no queden los argumentos pasados por el mail</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">window</span>.history.pushState({}, <span class="hljs-built_in">document</span>.title, aplicacion + <span class="hljs-string">"/"</span> + <span class="hljs-string">"defa.php"</span>);

    
    
  } <span class="hljs-keyword">else</span> {
    pop(aplicacion + <span class="hljs-string">"/main/panel.php"</span>);
  }

  startTime();
  checkLoged();
  $(<span class="hljs-string">'[data-toggle="popover"]'</span>).popover({
    <span class="hljs-attr">placement</span>: <span class="hljs-string">"bottom"</span>,
    <span class="hljs-attr">html</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">content</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> $(<span class="hljs-string">"#popoverUser"</span>).html();
    },
  });
  $(<span class="hljs-string">"#if_main"</span>).load(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    $(<span class="hljs-string">"#if_main"</span>).width(<span class="hljs-string">"100%"</span>);
    $(<span class="hljs-string">"#if_main"</span>).height(<span class="hljs-string">"100%"</span>);
  });
  $(<span class="hljs-string">".history"</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    pop(<span class="hljs-string">"log_accesos.php"</span>);
  });
  $(<span class="hljs-string">".logoff"</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    deleteProfile();
  });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Setea los valores del usuario en Local Storage usuario</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">l_setUserProfile</span>(<span class="hljs-params">$usuario, $grupo</span>) </span>{
  localStorage.clear();
  localStorage.removeItem(<span class="hljs-string">"usuario"</span>);
  <span class="hljs-keyword">const</span> usuario = {
    <span class="hljs-attr">username</span>: $usuario,
    <span class="hljs-attr">grupo</span>: $grupo,
  };
  <span class="hljs-built_in">window</span>.localStorage.setItem(<span class="hljs-string">"usuario"</span>, <span class="hljs-built_in">JSON</span>.stringify(usuario));
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pop</span>(<span class="hljs-params">url</span>) </span>{
  <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"if_main"</span>).src = url;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setMultipleAttributes</span>(<span class="hljs-params">el, attributes</span>) </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> attr <span class="hljs-keyword">in</span> attributes) el.setAttribute(attr, attributes[attr]);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">startTime</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> today = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
  <span class="hljs-keyword">var</span> h = today.getHours();
  <span class="hljs-keyword">var</span> m = today.getMinutes();
  <span class="hljs-keyword">var</span> s = today.getSeconds();
  m = checkTime(m);
  s = checkTime(s);
  <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"info"</span>).innerHTML =
    <span class="hljs-string">"&lt;p&gt;"</span> +
    <span class="hljs-string">"Hora actual: "</span> +
    h +
    <span class="hljs-string">":"</span> +
    m +
    <span class="hljs-string">":"</span> +
    s +
    <span class="hljs-string">"&lt;br/&gt; &lt;br/&gt;Sistema de seguimiento y autorización de pacientes para el producto soliris"</span> +
    <span class="hljs-string">"&lt;/p&gt;"</span>;
  <span class="hljs-keyword">var</span> t = setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    startTime();
  }, <span class="hljs-number">500</span>);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkTime</span>(<span class="hljs-params">i</span>) </span>{
  <span class="hljs-keyword">if</span> (i &lt; <span class="hljs-number">10</span>) {
    i = <span class="hljs-string">"0"</span> + i;
  } <span class="hljs-comment">// add zero in front of numbers &lt; 10</span>
  <span class="hljs-keyword">return</span> i;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkLoged</span>(<span class="hljs-params"></span>) </span>{
  setInterval(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    $.get(aplicacion + <span class="hljs-string">"/ajax/ajx.logonActive.php"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>{
      <span class="hljs-keyword">if</span> (data == <span class="hljs-string">"Session Perdida"</span>) {
        alert(data);
        deleteProfile();
        <span class="hljs-built_in">window</span>.location.href = aplicacion + <span class="hljs-string">"/login.php"</span>;
      }
    });
  }, <span class="hljs-number">300000</span>);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">viewHistory</span>(<span class="hljs-params"></span>) </span>{
  pop(<span class="hljs-string">"log_accesos.php"</span>);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deleteProfile</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> parametros = {
    <span class="hljs-attr">oper</span>: <span class="hljs-string">"delLogUser"</span>,
  };
  $.ajax({
    <span class="hljs-attr">url</span>: <span class="hljs-string">"ajax/ajx.login.php"</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">"POST"</span>,
    <span class="hljs-attr">data</span>: parametros,
    <span class="hljs-attr">async</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      $(<span class="hljs-string">"#profile-name"</span>).html(<span class="hljs-string">""</span>);
      $(<span class="hljs-string">"#inputUser"</span>).val(<span class="hljs-string">""</span>);
      $(<span class="hljs-string">"#inputPassword"</span>).val(<span class="hljs-string">""</span>);
      $(<span class="hljs-string">"#inputUser"</span>).show();
      $(<span class="hljs-string">"#remember"</span>).show();
    },
  });
  localStorage.clear();
  <span class="hljs-built_in">window</span>.location.href = <span class="hljs-string">"login.php"</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCurrentHostname</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> protocolo, url, var_port, port;

  protocolo = <span class="hljs-built_in">window</span>.location.protocol;
  url = <span class="hljs-built_in">window</span>.location.hostname;
  var_port = <span class="hljs-built_in">window</span>.location.port;

  <span class="hljs-keyword">if</span> (var_port !== <span class="hljs-string">""</span>) {
    port = <span class="hljs-string">":"</span> + var_port;
  } <span class="hljs-keyword">else</span> {
    port = <span class="hljs-string">""</span>;
  }

  <span class="hljs-keyword">return</span> protocolo + <span class="hljs-string">"//"</span> + url + port;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">timerElapsed</span>(<span class="hljs-params"></span>) </span>{
  counter = counter + <span class="hljs-number">1</span>;
  <span class="hljs-keyword">if</span> (counter == <span class="hljs-number">5</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>El modal se mostrará a los 25 minutos sin actividad</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="hljs-string">"#modal_session"</span>).modal({
      <span class="hljs-attr">backdrop</span>: <span class="hljs-string">"static"</span>, <span class="hljs-comment">// se previene del cierre del modals</span>
      <span class="hljs-attr">keyboard</span>: <span class="hljs-literal">false</span>,
    });
    timerReset();
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (counter == <span class="hljs-number">6</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>la sesión expirará despues de los 30 min sin actividad</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="hljs-string">"#modal_session"</span>).modal(<span class="hljs-string">"hide"</span>);
    $(<span class="hljs-string">"#modal_session"</span>).on(<span class="hljs-string">"hidden.bs.modal"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      alert(<span class="hljs-string">"Sesión Caducada"</span>);
      deleteProfile();
    });
  } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>document.getElementById(‘if_main’).contentWindow.location.reload();</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    timerReset();
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">timerReset</span>(<span class="hljs-params"></span>) </span>{
  clearTimeout(timer);
  timer = setTimeout(timerElapsed, <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>timer = setTimeout(timerElapsed, 1 * 30 * 100);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUrlHTTP</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> path = <span class="hljs-built_in">window</span>.location.pathname;
  <span class="hljs-keyword">var</span> appName = path.split(<span class="hljs-string">"/"</span>);
  <span class="hljs-keyword">return</span> appName[<span class="hljs-number">1</span>];
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">change_location</span>(<span class="hljs-params">value</span>) </span>{
  $.ajax({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"POST"</span>,
    <span class="hljs-attr">data</span>: {
      <span class="hljs-attr">grupo</span>: value,
    },
    <span class="hljs-attr">url</span>: <span class="hljs-string">"defa.php"</span>,
    <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>{
      <span class="hljs-built_in">window</span>.location.reload();
    },
  });
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getQuerystring</span>(<span class="hljs-params">key, default_</span>) </span>{
  <span class="hljs-keyword">if</span> (default_ == <span class="hljs-literal">null</span>) default_ = <span class="hljs-string">""</span>;
  key = key.replace(<span class="hljs-regexp">/[\[]/</span>, <span class="hljs-string">"\\["</span>).replace(<span class="hljs-regexp">/[\]]/</span>, <span class="hljs-string">"\\]"</span>);
  <span class="hljs-keyword">var</span> regex = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">"[\\?&amp;]"</span> + key + <span class="hljs-string">"=([^&amp;#]*)"</span>);
  <span class="hljs-keyword">var</span> qs = regex.exec(<span class="hljs-built_in">window</span>.location.href);
  <span class="hljs-keyword">if</span> (qs == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> default_;
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> qs[<span class="hljs-number">1</span>];
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUrlParameter</span>(<span class="hljs-params">name</span>) </span>{
  name = name.replace(<span class="hljs-regexp">/[\[]/</span>, <span class="hljs-string">"\\["</span>).replace(<span class="hljs-regexp">/[\]]/</span>, <span class="hljs-string">"\\]"</span>);
  <span class="hljs-keyword">var</span> regex = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">"[\\?&amp;]"</span> + name + <span class="hljs-string">"=([^&amp;#]*)"</span>);
  <span class="hljs-keyword">var</span> results = regex.exec(location.search);
  <span class="hljs-keyword">return</span> results === <span class="hljs-literal">null</span>
    ? <span class="hljs-string">""</span>
    : <span class="hljs-built_in">decodeURIComponent</span>(results[<span class="hljs-number">1</span>].replace(<span class="hljs-regexp">/\+/g</span>, <span class="hljs-string">" "</span>));
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
